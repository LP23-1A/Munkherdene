<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>To-do List</title>
    <link rel="stylesheet" href="./style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
  </head>

  <body>
    <div class="container">
      <div class="panels">
        <div class="panel">
          <div class="panel-header">
            To do
            <p class="numbers">1</p>
          </div>
          <div class="cards"></div>
          <div class="btn" onclick="openNote()">
            <i class="fa fa-plus"></i>
            <p>Add card</p>
          </div>
        </div>
        <div class="panel">
          <div class="panel-header">
            In progress
            <p class="numbers">1</p>
          </div>
          <div class="cards"></div>
          <div class="btn" onclick="openNote()">
            <i class="fa fa-plus"></i>
            <p>Add card</p>
          </div>
        </div>
        <div class="panel">
          <div class="panel-header">
            Stuck
            <p class="numbers">1</p>
          </div>
          <div class="cards"></div>
          <div class="btn" onclick="openNote()">
            <i class="fa fa-plus"></i>
            <p>Add card</p>
          </div>
        </div>
        <div class="panel">
          <div class="panel-header">
            Done
            <p class="numbers">1</p>
          </div>
          <div class="cards"></div>
          <div class="btn" onclick="openNote()">
            <i class="fa fa-plus"></i>
            <p>Add card</p>
          </div>
        </div>
      </div>
    </div>
    <div class="subcontainer">
      <div class="full">
        <div class="away"></div>
        <div class="note">
          <form id="card-form">
            <h1>Add task</h1>
            <div class="title">
              <label for="title">Title</label>
              <input type="text" name="title" id="title" />
              <p class="small-text">Бөглөнө үү</p>
            </div>
            <div class="description">
              <label for="description">Description</label>
              <textarea
                name="description"
                id="description"
                cols="30"
                rows="10"
              ></textarea>
            </div>
            <div class="status">
              <label for="status">Status</label>
              <select name="status" id="status">
                <option value="To do">To do</option>
                <option value="In progress">In progress</option>
                <option value="Stuck">Stuck</option>
                <option value="Done">Done</option>
              </select>
            </div>
            <div class="priority">
              <label for="priority">Priority</label>
              <select name="priority" id="priority">
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
              </select>
            </div>
            <button type="submit" id="button">Add task</button>
          </form>
        </div>
      </div>
    </div>
    <script>
      const note = document.querySelector(".subcontainer");
      const add = document.querySelector(".btn");
      const away = document.querySelector(".away");
      const cardForm = document.getElementById("card-form");

      const statusSelect = document.getElementById("status");
      function openNote() {
        note.style.display = "flex";
      }
      add.addEventListener("click", openNote);
      function closeNote() {
        note.style.display = "none";
      }
      away.addEventListener("click", closeNote);

      const cardsData = [];
      function addCard() {
        const title = document.getElementById("title").value;
        const description = document.getElementById("description").value;
        const status = statusSelect.value;
        const priority = document.getElementById("priority").value;
        const newCard = {
          title: title,
          description: description,
          status: status,
          priority: priority,
        };
        cardsData.push(newCard);
        renderCards();
        cardForm.reset();
        closeNote();
      }
      function renderCards() {
        const cardsContainers = document.querySelectorAll(".cards");

        cardsContainers.forEach((cardsContainer) => {
          cardsContainer.innerHTML = "";
        });
        cardsData.forEach((card, index) => {
          const cardHtml = createCardHtml(card, index);

          cardsContainers[getStatusIndex(card.status)].innerHTML += cardHtml;
        });
      }
      function createCardHtml(card, index) {
        return `
    <div class="card">
        <div class="icon">
            <i class="fa fa-check" aria-hidden="true"></i>
        </div>
        <div class="texts">
            <h4>${card.title}</h4>
            <p>${card.description}</p>
            <div class="text">${card.priority}</div>
        </div>
        <div class="icons">
            <div class="icon">
                <i class="fa fa-close" aria-hidden="true" onclick="removeCard(${index})"></i>
            </div>
            <div class="icon">
                <i class="fa fa-edit" aria-hidden="true" onclick="editCard(${index})"></i>
            </div>
        </div>
    </div>
    `;
      }
      function getStatusIndex(status) {
        const statuses = ["To do", "In progress", "Stuck", "Done"];
        return statuses.indexOf(status);
      }
      renderCards();
      const lastCard = cardsData[cardsData.length - 1];
      if (lastCard) {
        const statusIndex = getStatusIndex(lastCard.status);
        if (statusIndex == 1) {
          const cardsContainer = document.querySelectorAll(".cards");
          const cardHtml = createCardHtml(lastCard, cardsData.length - 1);
          cardsContainer.innerHTML += cardHtml;
        }
      }

      function removeCard(index) {
        cardsData.splice(index, 1);
        renderCards();
      }
      cardForm.addEventListener("submit", function (element) {
        element.preventDefault();
        addCard();
      });

      let editingCardIndex = null;
      function editCard(index) {
        editingCardIndex = index;
        const cardToEdit = cardsData[index];
        document.getElementById("title").value = cardToEdit.title;
        document.getElementById("description").value = cardToEdit.description;
        document.getElementById("status").value = cardToEdit.status;
        document.getElementById("priority").value = cardToEdit.priority;

        openNote();
      }
      function updateCard() {
        const cardToEdit = cardsData[editingCardIndex];
        cardToEdit.title = document.getElementById("title").value;
        cardToEdit.description = document.getElementById("description").value;
        cardToEdit.status = document.getElementById("status").value;
        cardToEdit.priority = document.getElementById("priority").value;

        cardForm.reset();
        closeNote();
        editingCardIndex = null;
        renderCards();
      }

      document.getElementById("button").addEventListener("click", function (e) {
        e.preventDefault();
        if (editingCardIndex !== null) {
          updateCard();
        } else {
          addCard();
        }
      });
      let cards = document.getElementsByClassName(".cards");
    </script>
  </body>
</html>
